storage_proto: gs
storage_root: vcm-ml-experiments/2020-05-07-sensitivity-experiments
experiment:
  name: $JOBNAME
  unique_id: false
  steps_to_run:
    #- coarsen_restarts  # not doing C384 -> C48 coarsening
    #- coarsen_diagnostics
    #- one_step_run
    #- create_training_data
    - train_sklearn_model
    - test_sklearn_model
    - prognostic_run
    #- baseline_run
  
  steps_config:

    coarsen_diagnostics:
      command: python workflows/coarsen_c384_diagnostics/coarsen_c384_diagnostics.py
      args:
        c384_diagnostics:
          location: $C384_DIAGNOSTICS
        coarsening_config: $CONFIG/coarsen_c384_diagnostics.yml

    train_sklearn_model:
      command: python -m fv3net.regression.sklearn
      args:
        training_data:
          location: gs://vcm-ml-experiments/2020-04-22-advisory-council/deep-shallow-mp-off-clearsky/create_training_data/
        train-config-file: $CONFIG/train_sklearn_model.yml
        
    test_sklearn_model: 
      # must denote argo command by using key 'argo'
      argo: argo submit test_sklearn_model.yaml
      args:
        # these should correspond to the names in the job yaml
        trained_model:
          from: train_sklearn_model
        testing_data:
          location: gs://vcm-ml-experiments/2020-04-22-advisory-council/deep-shallow-mp-off-clearsky/create_training_data/
        diagnostics_data:
          from: coarsen_diagnostics
        variable_filename: $CONFIG/test_sklearn_variable_names.yml

    prognostic_run:
      command: python workflows/prognostic_c48_run/orchestrate_submit_job.py
      args:
        restart_file_dir:
          location: gs://vcm-ml-experiments/2020-04-22-advisory-council/deep-shallow-mp-off-clearsky/one_step_run
        ic_timestep: $IC_TIMESTEP  # TODO: ensure this timestep is run for one-step jobs
        docker_image: $PROGNOSTIC_RUN_IMAGE
        --prog_config_yml: $CONFIG/prognostic_run.yml
        --model_url:
          from: train_sklearn_model
