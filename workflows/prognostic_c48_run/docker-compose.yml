# this is only for development purposes and integration with visual studio code
version: '3.4'
volumes:
  runs: {}
  guild: {}
  dvc: {}
services:
  fv3:
    depends_on:
      - tensorboard
    image: us.gcr.io/vcm-ml/emulator:55e360d0aa9322d7be5d299eee176d015c103569
    entrypoint: []
    command: [ls]
    volumes:
      - ../../:/fv3net
      - guild:/mnt/guild
      - dvc:/mnt/dvc
      - ${GOOGLE_APPLICATION_CREDENTIALS}:/tmp/key.json
      - /scratch/runs:/data
    environment:
      - GUILD_HOME=/mnt/guild
      - REMOTE_GUILD_HOME=gs://vcm-ml-archive/emulator
      - GOOGLE_APPLICATION_CREDENTIALS=/tmp/key.json
      # need to override these constraints
      - PIP_CONSTRAINT=/fv3net/constraints.txt
    env_file:
      .env
  jupyter:
    image: us.gcr.io/vcm-ml/emulator:55e360d0aa9322d7be5d299eee176d015c103569
    entrypoint: []
    command: []
    working_dir: "/mnt/jupyter"
    volumes:
      - dvc:/mnt
    ports:
      - "8890:8888"
  guild:
    image: guildai/guildai
    volumes:
      - dvc:/mnt
      - .:/fv3net
    environment:
      - GUILD_HOME=/mnt/guild
    command: [guild, view, --port, "8080"]
    ports:
      - 8080:8080
  tensorboard:
    image: tensorflow/tensorflow
    volumes:
        - runs:/data
    ports:
      - 6006:6006
    command: tensorboard --logdir=/data --bind_all
  fv3net_dev:
    image: us.gcr.io/vcm-ml/prognostic_run:ad102a241fa060338d31ec9b3503b94b82cc16d7
    entrypoint: []
    command: [bash]
    volumes:
      - .:/fv3net/workflows/prognostic_c48_run
      - ../../external/fv3fit:/fv3net/external/fv3fit
      - ../../external/loaders:/fv3net/external/loaders
      - ../../external/fv3gfs-fortran:/tmp/fortran-build
      - ../../external/fv3gfs-wrapper:/fv3net/external/fv3gfs-wrapper
      - ${GOOGLE_APPLICATION_CREDENTIALS}:/tmp/key.json
    environment:
      - GOOGLE_APPLICATION_CREDENTIALS=/tmp/key.json
