apiVersion: v1
kind: Pod
metadata:
  generateName: emulation-noah-
  labels:
    app: emulation
spec:
  volumes:
    - name: gcp-credentials-user-gcp-sa
      secret:
        secretName: gcp-key
    - name: dvc-cache
      emptyDir: {}
  containers:
    - name: main
      envFrom:
        - secretRef:
            name: wandb-token
      env:
        - name: GOOGLE_APPLICATION_CREDENTIALS
          value: /tmp/key
        - name: GOOGLE_APPLICATION_CREDENTIALS
          value: /secret/gcp-credentials/key.json
        - name: CLOUDSDK_AUTH_CREDENTIAL_FILE_OVERRIDE
          value: /secret/gcp-credentials/key.json
        - name: SHA
          value: 23752694e657fe0fcc93a804b8f7af405bf30976
        - name: WANDB_NAME
          value: "rh-all-noCloud-denormFix"
      image:
        us.gcr.io/vcm-ml/emulator:23752694e657fe0fcc93a804b8f7af405bf30976
      command: [./train.sh]
      args:
        - --wandb
        - --levels=25,50,75
        - --multi-output
        - --relative-humidity
        - --extra-variables=cos_zenith_angle,surface_pressure
        - --rh-weight=10000
        - --q-weight=0
        - --lr=0.01
        - --momentum=0.9
        - --epochs=100
        - --batch-size=512
        - --num-hidden=512
        - --num-hidden-layers=3
      volumeMounts:
        - name: gcp-credentials-user-gcp-sa
          mountPath: /secret/gcp-credentials
          readOnly: true
        - name: dvc-cache
          mountPath: /mnt/dvc
      resources:
        limits:
          cpu: "2000m"
          memory: 16Gi
          ephemeral-storage: 40Gi
        requests:
          cpu: "2000m"
          memory: 16Gi
          ephemeral-storage: 40Gi
  restartPolicy: Never
  tolerations:
    - effect: NoSchedule
      key: dedicated
      value: med-sim-pool