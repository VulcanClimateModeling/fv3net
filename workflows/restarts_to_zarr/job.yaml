apiVersion: batch/v1
kind: Job
metadata:
  labels:
    job-name: dask-job
  name: dask-job
  namespace: default
spec:
  backoffLimit: 0
  completions: 1
  parallelism: 1
  template:
    spec:
      volumes:
      - name: gcp-credentials-user-gcp-sa
        secret:
          secretName: gcp-key
      serviceAccountName: dask-admin
      containers:
      - name: dask-job
        image: us.gcr.io/vcm-ml/restarts_to_zarr
        command: 
        - python
        - /fv3net/workflows/restarts_to_zarr/job.py
        - gs://vcm-ml-data/2020-03-16-5-day-X-SHiELD-simulation-C384-restart-files
        - gs://vcm-ml-data/testing-noah/big.zarr
        - "--n-steps"
        - "100"
        - "--workers"
        - "6"
          #imagePullPolicy: Never
        resources: {}
        terminationMessagePath: /dev/termination-log
        terminationMessagePolicy: File
        env:
        - name: GOOGLE_APPLICATION_CREDENTIALS
          value: /secret/gcp-credentials/key.json
        - name: CLOUDSDK_AUTH_CREDENTIAL_FILE_OVERRIDE
          value: /secret/gcp-credentials/key.json
        volumeMounts:
        - mountPath: /secret/gcp-credentials
          name: gcp-credentials-user-gcp-sa
      dnsPolicy: ClusterFirst
      restartPolicy: Never
      schedulerName: default-scheduler
      securityContext: {}
#      terminationGracePeriodSeconds: 30
