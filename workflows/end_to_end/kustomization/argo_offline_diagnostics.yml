# see run_all.sh in prognostic run diags for how to get yaml config into pod 
apiVersion: argoproj.io/v1alpha1
kind: Workflow
metadata:
  generateName: offline-diags-
spec:
  arguments:
    parameters:
      - name: trained_model
      - name: testing_data
      - name: diagnostics_data
      #- name: variable_filename  # str of yaml file that got read in as var (ex in prog diags) , can echo to file and pass to python command
      - name: output
      - name: docker_image
  entrypoint: create-offline-diags
  volumes:
  - name: gcp-credentials-user-gcp-sa
    secret:
      secretName: gcp-key
  templates:
   - name: create-offline-diags
     container:
      image: '{{workflow.parameters.docker_image}}'
      command:
      - python 
      - -m
      - fv3net.diagnostics.sklearn_model_performance
      - '{{workflow.parameters.trained_model}}'
      - '{{workflow.parameters.testing_data}}'
      - '{{workflow.parameters.diagnostics_data}}'
      - workflows/end_to_end/kustomization/test_sklearn_variable_names.yml
      - '{{workflow.parameters.output}}'
      env:
      - name: GOOGLE_APPLICATION_CREDENTIALS
        value: /secret/gcp-credentials/key.json
      - name: CLOUDSDK_AUTH_CREDENTIAL_FILE_OVERRIDE
        value: /secret/gcp-credentials/key.json
      volumeMounts:
      - mountPath: /secret/gcp-credentials
        name: gcp-credentials-user-gcp-sa
      resources:
        requests:
            memory: "6Gi"
            cpu: "1000m"
        limits:
            memory: "6Gi"
            cpu: "1000m"
