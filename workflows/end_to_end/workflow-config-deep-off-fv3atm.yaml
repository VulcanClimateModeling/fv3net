storage_proto: gs
storage_root: vcm-ml-data/experiments-2020-03/end_to_end
experiment:
  name: deep-conv-off-fv3atm-a45d1781
  unique_id: False
  steps_to_run:
    - one_step_run
    - create_training_data
    - train_sklearn_model
    - test_sklearn_model
    - prognostic_run
    - baseline_run
  
  steps_config:
    one_step_run:
      command: python workflows/one_step_jobs/orchestrate_submit_jobs.py
      args:
        restart_data:
          location: gs://vcm-ml-data/2020-01-16-X-SHiELD-2019-12-02-pressure-coarsened-rundirs/restarts/C48
        experiment_yaml: ./workflows/one_step_jobs/deep-conv-off-fv3atm.yml
        docker_image: us.gcr.io/vcm-ml/fv3gfs-python:v0.3.1
        --config-version: v0.3

    create_training_data:
      command: python -m fv3net.pipelines.create_training_data
      args:
        one_step_data:
          from: one_step_run
        diagnostics_data:
          location: gs://vcm-ml-data/orchestration-testing/shield-coarsened-diags-2019-12-04
        --timesteps-per-output-file: 1
        --train-fraction: 0.5
        
    train_sklearn_model:
      command: python -m fv3net.regression.sklearn
      args:
        training_data:
          from: create_training_data
        train-config-file: ./workflows/sklearn_regression/maxdepth_13_rf_config.yml
        
    test_sklearn_model: 
      command: python -m fv3net.diagnostics.sklearn_model_performance
      args:
        trained_model:
          from: train_sklearn_model
        testing_data:
          from: create_training_data
        diagnostics_data:
          location: gs://vcm-ml-data/orchestration-testing/shield-coarsened-diags-2019-12-04
        --num_test_zarrs: 36
        --downsample-time-factor: 40

    prognostic_run:
      command: python workflows/prognostic_c48_run/orchestrate_submit_job.py
      args:
        restart_file_dir:
          from: one_step_run
        ic_timestep: "20160803.061500"
        docker_image: us.gcr.io/vcm-ml/prognostic_run:v0.1.1-oliwmtest
        --prog_config_yml: workflows/prognostic_c48_run/prognostic_config.yml
        --model_url:
          from: train_sklearn_model

    baseline_run:
      command: python workflows/prognostic_c48_run/orchestrate_submit_job.py
      args:
        restart_file_dir:
          from: one_step_run
        ic_timestep: "20160803.061500"
        docker_image: us.gcr.io/vcm-ml/prognostic_run:v0.1.1-oliwmtest
        --prog_config_yml: workflows/prognostic_c48_run/prognostic_config.yml


