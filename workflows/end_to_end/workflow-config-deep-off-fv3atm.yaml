storage_proto: gs
storage_root: vcm-ml-data/experiments-2020-03/end_to_end
experiment:
  name: deep-conv-off-fv3atm-a45d1781
  unique_id: False
  steps_to_run:
    - one_step_run
    - create_training_data
    - train_sklearn_model
    - test_sklearn_model
    - prognostic_run
  
  steps_config:
    one_step_run:
      command: python workflows/one_step_jobs/orchestrate_submit_jobs.py
      inputs:
        restart_data:
          location: gs://vcm-ml-data/2020-01-16-X-SHiELD-2019-12-02-pressure-coarsened-rundirs/restarts/C48
      extra_args: 
        experiment_yaml: ./workflows/one_step_jobs/deep-conv-off-fv3atm.yml
        docker_image: us.gcr.io/vcm-ml/fv3gfs-python:v0.3.1
        --config-version: v0.3

    create_training_data:
      command: workflows/create_training_data/orchestrator_job.sh
      inputs:
        one_step_data:
          from: one_step_run
        diagnostics_data:
          location: gs://vcm-ml-data/orchestration-testing/shield-coarsened-diags-2019-12-04
      extra_args: 
        timesteps-per-output-file: 1
        train-fraction: 0.5
        
    train_sklearn_model:
      command: workflows/sklearn_regression/orchestrator_train_sklearn.sh
      inputs:
        training_data:
          from: create_training_data
      extra_args:
        train-config-file: ./workflows/sklearn_regression/maxdepth_13_rf_config.yml
        
    test_sklearn_model: 
      command: workflows/sklearn_regression/orchestrator_test_sklearn.sh
      inputs:
        trained_model:
          from: train_sklearn_model
        testing_data:
          from: create_training_data
        diagnostics_data:
          location: gs://vcm-ml-data/orchestration-testing/shield-coarsened-diags-2019-12-04
      extra_args: 
        num-test-zarrs: 36

    prognostic_run:
      command: python workflows/prognostic_c48_run/orchestrate_submit_job.py
      inputs:
        sklearn_model:
          from: train_sklearn_model
        restart_file_dir:
          from: one_step_run
      extra_args:
        prognostic_yaml_adjust: workflows/prognostic_c48_run/prognostic_config.yml
        ic_timestep: "20160803.061500"
        docker_image: us.gcr.io/vcm-ml/prognostic-run-orchestration:fv3py_v0.3.1

