apiVersion: batch/v1
kind: Job
metadata:
  labels:
    app: integration-test
  name: end-to-end-integration-abcd
  namespace: default
spec:
  backoffLimit: 0
  template:
    spec:
      containers:
      - command: [workflows/end_to_end/submit_workflow.sh, tests/end_to_end_integration/e2e_config.yml]
        image: us.gcr.io/vcm-ml/fv3net:test_integration
        imagePullPolicy: Always
        env:
        - name: GOOGLE_APPLICATION_CREDENTIALS
          value: /secret/gcp-credentials/key.json
        - name: CLOUDSDK_AUTH_CREDENTIAL_FILE_OVERRIDE
          value: /secret/gcp-credentials/key.json
        name: integration-test
        resources:
          requests:
            cpu: 200m
            memory: 500M
        volumeMounts:
        - mountPath: /secret/gcp-credentials
          name: gcp-key-secret
          readOnly: true
      restartPolicy: Never
      terminationGracePeriodSeconds: 30
      volumes:
      - name: gcp-key-secret
        secret:
          defaultMode: 420
          secretName: gcp-key
