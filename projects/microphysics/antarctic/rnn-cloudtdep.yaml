use_wandb: true
wandb:
  wandb_project: microphysics-emulation
batch_size: 512
epochs: 20
nfiles_valid: 100
valid_freq: 2
out_url: gs://vcm-ml-scratch/andrep/2021-10-02-wandb-training/dense
train_url: gs://vcm-ml-experiments/microphysics-emulation/2021-11-24/microphysics-training-data-v3-training_netcdfs/train
test_url: gs://vcm-ml-experiments/microphysics-emulation/2021-11-24/microphysics-training-data-v3-training_netcdfs/test
tensor_transform:
  - to: log_cloud_input
    source: cloud_water_mixing_ratio_input
    transform:
      epsilon: 1e-10
  - to: log_humidity_input
    source: specific_humidity_input
    transform:
      epsilon: 1e-8
  - to: cloud_precpd_difference
    condition_on: air_temperature_input
    min_scale: 1e-8
    bins: 50
    field:
      input_name: cloud_water_mixing_ratio_input
      output_name: cloud_water_mixing_ratio_after_precpd
  - to: temperature_precpd_difference
    condition_on: air_temperature_input
    min_scale: 1e-8
    bins: 50
    field:
      input_name: air_temperature_input
      output_name: air_temperature_after_precpd
  - to: temperature_gscond_difference
    condition_on: air_temperature_input
    min_scale: 1e-8
    bins: 50
    field:
      input_name: air_temperature_input
      output_name: air_temperature_after_gscond
  - to: humidity_precpd_difference
    condition_on: air_temperature_input
    min_scale: 1e-8
    bins: 50
    field:
      input_name: specific_humidity_input
      output_name: specific_humidity_after_precpd
  - to: humidity_gscond_difference
    condition_on: air_temperature_input
    min_scale: 1e-8
    bins: 50
    field:
      input_name: specific_humidity_input
      output_name: specific_humidity_after_gscond
loss:
  optimizer:
    kwargs:
      learning_rate: 0.0001
    name: Adam
  metric_variables:
  - cloud_water_mixing_ratio_after_precpd
  - air_temperature_after_precpd
  - specific_humidity_after_precpd
  - air_temperature_after_gscond
  - specific_humidity_after_gscond
  loss_variables:
  - total_precipitation
  - cloud_precpd_difference
  - temperature_precpd_difference
  - humidity_precpd_difference
  - temperature_gscond_difference
  - humidity_gscond_difference
  weights:
    total_precipitation: 1.0
    cloud_precpd_difference: 1.0
    temperature_precpd_difference: 1.0
    humidity_precpd_difference: 1.0
    temperature_gscond_difference: 1.0
    humidity_gscond_difference: 1.0
model:
  architecture:
    kwargs:
      channels: 256
    name: rnn-v1-shared-weights
  input_variables:
  - air_temperature_input
  - specific_humidity_input
  - cloud_water_mixing_ratio_input
  - pressure_thickness_of_atmospheric_layer
  - specific_humidity_after_last_gscond
  - air_temperature_after_last_gscond
  - log_humidity_input
  - log_cloud_input
  direct_out_variables:
  - cloud_precpd_difference
  - total_precipitation
  - temperature_precpd_difference
  - humidity_precpd_difference
  - temperature_gscond_difference
  - humidity_gscond_difference
  normalize_key: mean_std
  enforce_positive: false
  selection_map: {}
  timestep_increment_sec: 900
transform:
  antarctic_only: false
  derived_microphys_timestep: 900
  use_tensors: true
  vertical_subselections: null

