apiVersion: batch/v1
kind: Job
metadata:
  labels:
    app: testing-job
    waitForMe: imma-smol-job
  name: tiny-job2
  namespace: default
spec:
  backoffLimit: 0
  template:
    spec:
      containers: 
      - command: ["bash", "-c"]
        image: us.gcr.io/vcm-ml/prognostic_run:cuda-base
        imagePullPolicy: IfNotPresent
        name: tiny-job2
        args:
        - |
          export LD_LIBRARY_PATH=/usr/local/nvidia/lib64:$LD_LIBRARY_PATH
          export PATH=/usr/local/nvidia/bin:$PATH
          echo $(ls /usr/local/nvidia/bin)
          nvidia-smi
          sleep 60
          echo DONE!
        resources:
          requests:
            cpu: "4"
            memory: 6Gi
          limits:
            cpu: "4"
            memory: 6Gi
            nvidia.com/gpu: 1
      restartPolicy: Never
      terminationGracePeriodSeconds: 30
      tolerations:
      - key: "dedicated"
        operator: "Equal"
        value: "gpu-sim-pool"
        effect: "NoSchedule" 
      - key: "nvidia.com/gpu"
        operator: "Exists"
        effect: "NoSchedule" 
