use_wandb: true
wandb:
  wandb_project: microphysics-emulation
batch_size: 128
epochs: 50
nfiles_valid: 100
valid_freq: 2
out_url: gs://vcm-ml-scratch/andrep/2021-10-02-wandb-training/dense
train_url: gs://vcm-ml-experiments/microphysics-emulation/2021-11-24/microphysics-training-data-v3-training_netcdfs/train
test_url: gs://vcm-ml-experiments/microphysics-emulation/2021-11-24/microphysics-training-data-v3-training_netcdfs/test
tensor_transform:
  - source: cloud_water_mixing_ratio_after_precpd
    to: log_cloud_output
    # log by default
    transform: {}
  - source: cloud_water_mixing_ratio_input
    to: log_cloud_input
    # log by default
    transform: {}
loss:
  optimizer:
    kwargs:
      learning_rate: 0.0001
    name: Adam
  loss_variables:
  - air_temperature_after_precpd
  - specific_humidity_after_precpd
  - log_cloud_output
  - total_precipitation
  - cloud_water_mixing_ratio_after_precpd
  weights:
    air_temperature_after_precpd: 500000.0
    specific_humidity_after_precpd: 500000.0
    log_cloud_output: 2.0
    total_precipitation: 5
    cloud_water_mixing_ratio_after_precpd: 0.0
transformed_model:
  architecture:
    kwargs: {}
    name: dense
  fields:
    # prognostic variables
    - input_name: air_temperature_input
      output_name: air_temperature_after_precpd
      selection: {stop: -10}
      residual: true
    - input_name: specific_humidity_input
      output_name: specific_humidity_after_precpd
      selection: {stop: -10}
      residual: true
    - input_name: log_cloud_input
      output_name: log_cloud_output
      selection: {stop: -10}
      residual: true
    # diagnostic variables
    - output_name: total_precipitation
      residual: false
    # inputs
    - input_name: pressure_thickness_of_atmospheric_layer
      selection: {stop: -10}
  normalize_key: mean_std
  # very important to turn this off for log transformed data
  enforce_positive: false
  timestep_increment_sec: 900
transform:
  antarctic_only: false
  derived_microphys_timestep: 900
  use_tensors: true
  vertical_subselections: null
