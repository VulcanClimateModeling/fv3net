apiVersion: argoproj.io/v1alpha1
kind: WorkflowTemplate
metadata:
  name: prognostic-metrics
spec:
  entrypoint: metrics
  templates:
    - name: metrics
      inputs:
        parameters:
        - name: output_url
          value: experiments-2020-03/prognostic_run_diags
        - name: runid
          value: deep-and-mp-off-baseline
        artifacts:
          - name: diags-netcdf
            path: "/diags.nc"
            gcs:
              bucket: vcm-ml-data
              key: experiments-2020-03/prognostic_run_diags/deep-and-mp-off-baseline.nc
      container:
        image: us.gcr.io/vcm-ml/metrics:v0.1.0
        command: ["bash", "-c"]
        args:
          - python3 /metrics.py /diags.nc > /metrics.json
      outputs:
        artifacts:
          - name: metrics_json
            path: /metrics.json
            archive: 
              none: {}
            gcs:
              bucket: vcm-ml-data
              key: "{{inputs.parameters.output_url}}/{{inputs.parameters.runid}}.json"
